document.addEventListener("DOMContentLoaded",function(){!function(t,e){var n=e.body,s=e.querySelector.bind(e),a=e.querySelectorAll.bind(e),o=s("html"),r=s("#gotop"),c=s("#menu"),l=s("#header"),d=s("#mask"),h=s("#menu-toggle"),u=s("#menu-off"),f=s("#loading"),v=t.requestAnimationFrame,m=12,g=Array.prototype.forEach,p="ontouchstart"in t&&/Mobile|Android|iOS|iPhone|iPad|iPod|Windows Phone|KFAPWI/i.test(navigator.userAgent)?"touchstart":"click",L=/micromessenger/i.test(navigator.userAgent),w=function(){},y=function(t){var e=t.offsetLeft,i=t.offsetTop;if(t.offsetParent){var n=arguments.callee(t.offsetParent);e+=n.x,i+=n.y}return{x:e,y:i}},x=navigator.userAgent.match(/firefox/i)||navigator.msPointerEnabled?e.documentElement:n,E={goTop:function(t){var e=x.scrollTop,i=arguments.length>2?arguments[1]:Math.abs(e-t)/m;e&&e>t?(x.scrollTop=Math.max(e-i,0),v(arguments.callee.bind(this,t,i))):t&&t>e?(x.scrollTop=Math.min(e+i,t),v(arguments.callee.bind(this,t,i))):this.toc.actived(t)},toggleGotop:function(e){e>t.innerHeight/2?r.classList.add("in"):r.classList.remove("in")},toggleMenu:function(e){var i=s("#main");if(e){if(c.classList.remove("hide"),t.innerWidth<1241)if(d.classList.add("in"),c.classList.add("show"),L){var n=x.scrollTop;i.classList.add("lock"),i.scrollTop=n}else o.classList.add("lock")}else if(c.classList.remove("show"),d.classList.remove("in"),L){var n=i.scrollTop;i.classList.remove("lock"),x.scrollTop=n}else o.classList.remove("lock")},fixedHeader:function(t){t>l.clientHeight?l.classList.add("fixed"):l.classList.remove("fixed")},toc:function(){var t=s("#post-toc");if(!t||!t.children.length)return{fixed:w,actived:w};var e=s(".post-header").clientHeight,n=l.clientHeight,a=s("#post-content").querySelectorAll("h1, h2, h3, h4, h5, h6");return t.querySelector('a[href="#'+a[0].id+'"]').parentNode.classList.add("active"),{fixed:function(i){i>=e-n?t.classList.add("fixed"):t.classList.remove("fixed")},actived:function(e){for(i=0,len=a.length;i<len;i++)if(e>y(a[i]).y-n-5){t.querySelector("li.active").classList.remove("active");var s=t.querySelector('a[href="#'+a[i].id+'"]').parentNode;s.classList.add("active")}e<y(a[0]).y&&(t.querySelector("li.active").classList.remove("active"),t.querySelector('a[href="#'+a[0].id+'"]').parentNode.classList.add("active"))}}}(),hideOnMask:[],modal:function(t){this.$modal=s(t),this.$off=this.$modal.querySelector(".close");var e=this;this.show=function(){d.classList.add("in"),e.$modal.classList.add("ready"),setTimeout(function(){e.$modal.classList.add("in")},0)},this.onHide=w,this.hide=function(){e.onHide(),d.classList.remove("in"),e.$modal.classList.remove("in"),setTimeout(function(){e.$modal.classList.remove("ready")},300)},this.toggle=function(){return e.$modal.classList.contains("in")?e.hide():e.show()},E.hideOnMask.push(this.hide),this.$off&&this.$off.addEventListener(p,this.hide)},share:function(){var t=s("#pageShare"),i=s("#shareFab"),n=new this.modal("#globalShare");s("#menuShare").addEventListener(p,n.toggle),i&&(i.addEventListener(p,function(){t.classList.toggle("in")},!1),e.addEventListener(p,function(e){!i.contains(e.target)&&t.classList.remove("in")},!1));var o=new this.modal("#wxShare");o.onHide=n.hide,g.call(a(".wxFab"),function(t){t.addEventListener(p,o.toggle)})},search:function(){function t(){e.classList.toggle("in")}var e=s("#search-wrap");s("#search").addEventListener(p,t)},reward:function(){var t=new this.modal("#reward");s("#rewardBtn").addEventListener(p,t.toggle)},waterfall:function(){t.innerWidth<760||g.call(a(".waterfall"),function(t){var e=t.querySelectorAll(".waterfall-item"),i=[0,0];g.call(e,function(t){var e=i[0]<=i[1]?0:1;t.style.cssText="top:"+i[e]+"px;left:"+(e>0?"50%":0),i[e]+=t.offsetHeight}),t.style.height=Math.max(i[0],i[1])+"px",t.classList.add("in")})},tabBar:function(t){t.parentNode.parentNode.classList.toggle("expand")},page:function(){var t=a(".fade, .fade-scale"),e=!1;return{loaded:function(){g.call(t,function(t){t.classList.add("in")}),e=!0},unload:function(){g.call(t,function(t){t.classList.remove("in")}),e=!1},visible:e}}(),lightbox:function(){function i(i){this.$img=i.querySelector("img"),this.$overlay=i.querySelector("overlay"),this.margin=40,this.title=this.$img.title||this.$img.alt||"",this.isZoom=!1;var s,a,o,r,c;this.calcRect=function(){r=n.clientWidth,c=n.clientHeight;var t=c-2*this.margin,e=s,i=a,l=(this.margin,e>r?r/e:1),d=i>t?t/i:1,h=Math.min(l,d);return e*=h,i*=h,{w:e,h:i,t:(c-i)/2-o.top,l:(r-e)/2-o.left+this.$img.offsetLeft}},this.setImgRect=function(t){this.$img.style.cssText="width: "+t.w+"px; max-width: "+t.w+"px; height:"+t.h+"px; top: "+t.t+"px; left: "+t.l+"px"},this.setFrom=function(){this.setImgRect({w:o.width,h:o.height,t:0,l:(i.offsetWidth-o.width)/2})},this.setTo=function(){this.setImgRect(this.calcRect())},this.addTitle=function(){this.title&&(this.$caption=e.createElement("div"),this.$caption.innerHTML=this.title,this.$caption.className="overlay-title",i.appendChild(this.$caption))},this.removeTitle=function(){this.$caption&&i.removeChild(this.$caption)};var l=this;this.zoomIn=function(){s=this.$img.naturalWidth||this.$img.width,a=this.$img.naturalHeight||this.$img.height,o=this.$img.getBoundingClientRect(),i.style.height=o.height+"px",i.classList.add("ready"),this.setFrom(),this.addTitle(),this.$img.classList.add("zoom-in"),setTimeout(function(){i.classList.add("active"),l.setTo(),l.isZoom=!0},0)},this.zoomOut=function(){this.isZoom=!1,i.classList.remove("active"),this.$img.classList.add("zoom-in"),this.setFrom(),setTimeout(function(){l.$img.classList.remove("zoom-in"),l.$img.style.cssText="",l.removeTitle(),i.classList.remove("ready"),i.removeAttribute("style")},300)},i.addEventListener("click",function(t){l.isZoom?l.zoomOut():"IMG"===t.target.tagName&&l.zoomIn()}),e.addEventListener("scroll",function(){l.isZoom&&l.zoomOut()}),t.addEventListener("resize",function(){l.isZoom&&l.zoomOut()})}g.call(a(".img-lightbox"),function(t){new i(t)})}(),loadScript:function(t){t.forEach(function(t){var i=e.createElement("script");i.src=t,i.async=!0,n.appendChild(i)})}};t.addEventListener("load",function(){f.classList.remove("active"),E.page.loaded(),t.lazyScripts&&t.lazyScripts.length&&E.loadScript(t.lazyScripts)}),t.addEventListener("DOMContentLoaded",function(){E.waterfall();var t=x.scrollTop;E.toc.fixed(t),E.toc.actived(t),E.page.loaded()});var $=!1;s('a[href^="mailto"]').addEventListener(p,function(){$=!0}),t.addEventListener("beforeunload",function(t){$?$=!1:E.page.unload()}),t.addEventListener("pageshow",function(){!E.page.visible&&E.page.loaded()}),t.addEventListener("resize",function(){t.BLOG.even=p="ontouchstart"in t?"touchstart":"click",E.toggleMenu(),E.waterfall()}),r.addEventListener(p,function(){v(E.goTop.bind(E,0))},!1),h.addEventListener(p,function(t){E.toggleMenu(!0),t.preventDefault()},!1),u.addEventListener(p,function(){c.classList.add("hide")},!1),d.addEventListener(p,function(t){E.toggleMenu(),E.hideOnMask.forEach(function(t){t()}),t.preventDefault()},!1),e.addEventListener("scroll",function(){var t=x.scrollTop;E.toggleGotop(t),E.fixedHeader(t),E.toc.fixed(t),E.toc.actived(t)},!1),t.BLOG.SHARE&&E.share(),t.BLOG.REWARD&&E.reward(),E.noop=w,E.even=p,E.$=s,E.$$=a,Object.keys(E).reduce(function(t,e){return t[e]=E[e],t},t.BLOG),t.Waves?(Waves.init(),Waves.attach(".global-share li",["waves-block"]),Waves.attach(".article-tag-list-link, #page-nav a, #page-nav span",["waves-button"])):console.error("Waves loading failed.")}(window,document),function(t){function e(t){if(r)t(r);else{var e=new XMLHttpRequest;e.open("GET",L,!0),e.onload=function(){if(this.status>=200&&this.status<300){var e=JSON.parse(this.response);r=e instanceof Array?e:e.posts,t(r)}else console.error(this.statusText)},e.onerror=function(){console.error(this.statusText)},e.send()}}function i(t,e){return t.replace(/\{\w+\}/g,function(t){var i=t.replace(/\{|\}/g,"");return e[i]||""})}function n(t){var e="";e=t.length?t.map(function(t){return i(p,{title:t.title,path:(c.BLOG.ROOT+"/"+t.path).replace(/\/{2}/g,"/"),date:new Date(t.date).toLocaleDateString(),tags:t.tags.map(function(t){return"<span>#"+t.name+"</span>"}).join("")})}).join(""):'<li class="tips"><i class="icon icon-coffee icon-3x"></i><p>Results not found!</p></li>',g.innerHTML=e}function s(t,e){return e.lastIndex=0,e.test(t)}function a(t,e){return s(t.title,e)||t.tags.some(function(t){return s(t.name,e)})||s(t.text,e)}function o(t){var i=this.value.trim();if(i){var s=new RegExp(i.replace(/[ ]/g,"|"),"gmi");e(function(t){var e=t.filter(function(t){return a(t,s)});n(e),x.show()}),t.preventDefault()}}var r,c=window||this,l=c.BLOG.even,d=(t.body,t.querySelector.bind(t)),h=(t.querySelectorAll.bind(t),d("#search")),u=d("#search-wrap"),f=d("#key"),v=d("#back"),m=d("#search-panel"),g=d("#search-result"),p=d("#search-tpl").innerHTML,L=(c.BLOG.ROOT+"/content.json").replace(/\/{2}/g,"/"),w=c.BLOG.noop,y=d("html"),x={show:function(){c.innerWidth<760?y.classList.add("lock-size"):w,m.classList.add("in")},hide:function(){c.innerWidth<760?y.classList.remove("lock-size"):w,m.classList.remove("in")}};h.addEventListener(l,function(){u.classList.toggle("in"),f.value="",u.classList.contains("in")?f.focus():f.blur()}),v.addEventListener(l,function(){u.classList.remove("in"),x.hide()}),document.addEventListener(l,function(t){"key"!==t.target.id&&"click"===l&&x.hide()}),f.addEventListener("input",o),f.addEventListener(l,o)}(document)},!1);
